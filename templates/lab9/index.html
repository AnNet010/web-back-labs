{% extends "base.html" %}

{% block lab %}–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 9{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename='lab9/lab9.js') }}"></script>
<style>
/* –§–æ–Ω –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω—É—Ç—Ä–∏ main */
main {
    background: #ffe2a3;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    color: #fff; /* –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
.container {
    position: relative;
    min-height: 600px;
    background: url("{{ url_for('static', filename='lab9/background.jpg') }}") no-repeat center center;
    background-size: cover;
    border-radius: 10px;
    padding: 20px;
}


/* –ü–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–æ—Ä–æ–±–∫–∏ */
.gift-box {
    position: absolute;
    width: 150px;
    height: 150px;
    cursor: pointer;
    transition: transform 0.3s;
}

.gift-box:hover {
    transform: scale(1.1);
}

.gift-box img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.opened {
    opacity: 0.3;
    cursor: not-allowed;
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è */
.congratulation-modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #ffefba, #ffffff); /* –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π —Ñ–æ–Ω */
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    z-index: 1000;
    max-width: 500px;
    text-align: center;
    color: #000; /* —á–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è */
}

/* –¢–µ–∫—Å—Ç –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª–∫–∏ */
.congratulation-modal h2,
.congratulation-modal p {
    color: #000;
}

.congratulation-modal img {
    display: block;
    margin: 20px auto;
    max-width: 300px;
    max-height: 300px;
    width: auto;
    height: auto;
}

/* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ –º–æ–¥–∞–ª–∫–∏ */
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    z-index: 999;
}

/* –ü–∞–Ω–µ–ª—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π */
.info-panel {
    background: linear-gradient(135deg, #ff6b6b, #32ff7e); /* –∫—Ä–∞—Å–Ω–æ-–∑–µ–ª—ë–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    color: #fff;
    font-weight: bold;
}

/* –ö–Ω–æ–ø–∫–∏ */
.close-btn, .btn, .btn-clear {
    transition: all 0.3s;
}

.close-btn {
    background: #ff4444;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 20px;
}

.close-btn:hover {
    background: #ff7979;
}

/* –û—à–∏–±–∫–∏ */
.error-message {
    background: #ffcccc;
    color: #cc0000;
    padding: 10px;
    border-radius: 5px;
    margin-top: 10px;
    display: none;
}

.holiday-title {
    color: #ff4500; /* –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤–æ-–∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç */
    text-shadow: 0.5px 0.5px 1px #000000; /* –ª–µ–≥–∫–∞—è —Ç–µ–Ω—å –¥–ª—è –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ */
}

/* –°—Ç–∏–ª—å –¥–ª—è –∫–æ—Ä–æ–±–æ–∫, —Ç—Ä–µ–±—É—é—â–∏—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
{% if not is_authenticated %}
.auth-box {
    position: relative;
}

.auth-box::after {
    content: 'üîí';
    position: absolute;
    top: 5px;
    right: 5px;
    background: white;
    border-radius: 50%;
    padding: 5px;
    font-size: 16px;
    z-index: 10;
}
{% endif %}

/* –ö–Ω–æ–ø–∫–∞ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞ */
.santa-btn {
    background: #ff0000;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 20px;
    margin-right: 10px;
}

/* –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ */
.reset-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 20px;
}
</style>
{% endblock %}

{% block main %}
    <h1><span class="holiday-title">üéÑ‚ú® –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è üéÅ‚ùÑÔ∏è</span></h1>
    
    {% if is_authenticated %}
    <div style="background: #4eeaff; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
        üéÖ –ü—Ä–∏–≤–µ—Ç, <strong>{{ username }}</strong>! –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –∏ –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≤—Å–µ –∫–æ—Ä–æ–±–∫–∏!
    </div>
    {% else %}
    <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
        üîí –í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. –ö–æ—Ä–æ–±–∫–∏ —Å –∑–∞–º–∫–æ–º –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
        <a href="{{ url_for('lab8.login') }}">–í–æ–π—Ç–∏</a> | 
        <a href="{{ url_for('lab8.register') }}">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
    </div>
    {% endif %}
    
    <div class="info-panel">
        <div>
            <strong>–û—Ç–∫—Ä—ã—Ç–æ –∫–æ—Ä–æ–±–æ–∫:</strong> <span id="opened-count">{{ opened_count }}</span>/3
        </div>
        <div>
            <strong>–û—Å—Ç–∞–ª–æ—Å—å –∫–æ—Ä–æ–±–æ–∫:</strong> <span id="remaining-count">{{ remaining }}</span>/10
        </div>
    </div>
    
    <div class="error-message" id="error-message"></div>
    
    <div class="container" id="gifts-container">
        {% for position in positions %}
        <div class="gift-box {% if position.requires_auth and not is_authenticated %}auth-box{% endif %}" 
             data-box-id="{{ position.id }}" 
             style="top: {{ position.top }}%; left: {{ position.left }}%; z-index: {{ position.zIndex }};">
            <img src="{{ position.initial_image }}" alt="–ü–æ–¥–∞—Ä–æ–∫ {{ position.id + 1 }}">
        </div>
        {% endfor %}
    </div>
    
    <div class="modal-overlay" id="modal-overlay"></div>
    <div class="congratulation-modal" id="congratulation-modal">
        <h2 id="congratulation-title">–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ!üéâ</h2>
        <p id="congratulation-text"></p>
        <img id="gift-image" src="" alt="–ü–æ–¥–∞—Ä–æ–∫">
        <button class="close-btn" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    
    <div style="text-align: center; margin-top: 20px;">
        {% if is_authenticated %}
        <button class="santa-btn" onclick="callSanta()">
            üéÖ –î–µ–¥ –ú–æ—Ä–æ–∑ ‚Äì –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –∫–æ—Ä–æ–±–∫–∏
        </button>
        {% else %}
        <button class="reset-btn" onclick="resetGame()">
            üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É
        </button>
        {% endif %}
    </div>
    
    <div style="margin-top: 20px; color: #666; text-align: center;">
        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ—Ä–æ–±–∫–∏, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—Ä–∫–∏. –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ 3 –∫–æ—Ä–æ–±–∫–∏!</p>
        {% if not is_authenticated %}
        <p>üîí –ö–æ—Ä–æ–±–∫–∏ —Å –∑–∞–º–∫–æ–º –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.</p>
        {% endif %}
    </div>
{% endblock %}