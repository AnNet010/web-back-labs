{% extends "base.html" %}

{% block lab %}Лабораторная работа 8{% endblock %}

{% block main %}
<h1 style="text-align:center;margin-top:30px;">Список статей</h1>


<div style="max-width:600px;margin:20px auto; display:flex; gap:10px;">
    <form action="/lab8/articles" method="get" style="flex:1; display:flex; gap:5px;">
        <input
            type="text"
            name="q"
            placeholder="Поиск по статьям"
            value="{{ request.args.get('q', '') }}"
            style="flex:1;padding:8px 12px;border:1px solid #cbd5e1;border-radius:6px;"
        >
        <button
            type="submit"
            style="padding:8px 16px;border:none;border-radius:6px;background:#2563eb;color:#fff;cursor:pointer;">
            Найти
        </button>
    </form>
</div>


{% for article in articles %}
<div style="background:#fff;padding:20px;margin:20px auto;max-width:600px;border-radius:12px;box-shadow:0 6px 15px rgba(0,0,0,0.1);">
    <h2>{{ article.title }}</h2>
    <p>{{ article.article_text }}</p>

    {% if current_user.is_authenticated and article.login_id == current_user.id %}
    <div style="display:flex; gap:10px; margin-top:15px;">
        <form action="{{ url_for('lab8.edit_article', article_id=article.id) }}" method="get" style="flex:1; margin:0;">
            <button type="submit"
                    style="width:100%; border:none; border-radius:6px; padding:8px; background:#2563eb; color:#fff;">
                Редактировать
            </button>
        </form>

        <form action="{{ url_for('lab8.delete_article', article_id=article.id) }}" method="post" style="flex:1; margin:0;">
            <button type="submit"
                    style="width:100%; border:none; border-radius:6px; padding:8px; background:#f05755; color:#fff;"
                    onclick="return confirm('Вы уверены, что хотите удалить эту статью?');">
                Удалить
            </button>
        </form>

        <form action="{{ url_for('lab8.toggle_public', article_id=article.id) }}" method="get" style="flex:1; margin:0;">
            {% if article.is_public %}
            <button type="submit"
                    style="width:100%; border:none; border-radius:6px; padding:8px; background:#10b981; color:#fff;">
                Сделать приватной
            </button>
            {% else %}
            <button type="submit"
                    style="width:100%; border:none; border-radius:6px; padding:8px; background:#ac5cfc; color:#fff;">
                Сделать публичной
            </button>
            {% endif %}
        </form>
    </div>
    {% else %}
        <small>
            Автор: {{ article.author_login }}
            {% if article.is_public %}
                | <span style="color:#10b981;font-weight:bold;">Публичная</span>
            {% endif %}
        </small>
    {% endif %}
</div>
{% else %}
<p style="text-align:center;">Статей пока нет.</p>
{% endfor %}

{% endblock %}
